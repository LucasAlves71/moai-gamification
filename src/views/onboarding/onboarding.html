<div class="onboarding-container">
    <div class="onboarding-background">
        <!-- Efeito de oceano similar ao da página de ilhas -->
        <div class="ocean">
            <div class="ocean-wave wave-1"></div>
            <div class="ocean-wave wave-2"></div>
            <div class="ocean-wave wave-3"></div>
        </div>

        <!-- Bolhas decorativas -->
        <div class="bubble bubble-1"></div>
        <div class="bubble bubble-2"></div>
        <div class="bubble bubble-3"></div>
    </div>

    <!-- Conteúdo principal do onboarding -->
    <div class="onboarding-content">
        <!-- Área do personagem -->
        <div class="character-container">
            <div class="character-image">
                <!-- Imagem do personagem será carregada dinamicamente via CSS/Angular -->
                <img ng-src="public/img/mascote/mascote-{{currentStep}}.png" alt="Manu'Kai" class="mascote-img">
            </div>
        </div>

        <!-- Área do balão de fala -->
        <div class="speech-bubble-container" ng-show="currentStep < 11">
            <div class="speech-bubble">
                <h3 class="speech-title">{{speechData[currentStep-1].title}}</h3>
                <p class="speech-text">{{speechData[currentStep-1].text}}</p>
                <div class="speech-actions">
                    <button class="btn btn-moai-secondary" ng-click="previousStep()" ng-if="currentStep > 1">Voltar</button>
                    <button class="btn btn-moai-primary" ng-click="nextStep()">
                        {{currentStep < 10 ? 'Continuar' : 'Definir sua ilha'}}
                    </button>
                </div>
                <div class="progress mt-3">
                    <div class="progress-bar bg-moai-accent" role="progressbar"
                         ng-style="{'width': (currentStep/11*100) + '%'}"
                         aria-valuenow="{{currentStep}}" aria-valuemin="0" aria-valuemax="11">
                    </div>
                </div>
            </div>
        </div>

        <!-- Formulário para o passo final (nome da ilha e foto) -->
        <div class="island-form-container" ng-show="currentStep === 11">
            <div class="island-form card-moai p-4">
                <h2 class="form-title mb-3">Personalize sua jornada</h2>
                <p class="form-subtitle mb-4">
                    Esta será sua base de operações durante toda a jornada.
                </p>

                <div class="form-floating mb-4">
                    <input type="text" class="form-control" id="islandNameInput"
                           ng-model="islandName" placeholder="Nome da ilha">
                    <label for="islandNameInput">Nome da sua ilha</label>
                </div>

                <div class="alert alert-danger" role="alert" ng-show="nameError">
                    Por favor, insira um nome para sua ilha antes de continuar.
                </div>

                <!-- Seção de foto de perfil -->
                <h4 class="photo-title mb-3">Sua foto de explorador</h4>
                <div class="profile-photo-section mb-4">
                    <div class="text-center mb-4">
                        <div class="profile-photo-container d-inline-block position-relative">
                            <img ng-src="{{selectedImageUrl || 'public/img/default-avatar.png'}}"
                                 alt="Foto de perfil" class="profile-photo rounded-circle img-fluid">
                            <div class="photo-edit-btn" ng-click="openFileSelector()">
                                <span>✏️</span>
                            </div>
                        </div>
                    </div>
                    <div class="text-center mt-3">
                        <p class="text-muted small">Adicione uma foto para seu perfil MOAI</p>
                        <input type="file" id="onboarding-photo-input" accept="image/*" class="d-none"
                               onchange="angular.element(this).scope().handleFileSelect(this)">
                    </div>
                </div>

                <div class="form-actions mt-4 text-center">
                    <button class="btn btn-moai-secondary me-2" ng-click="previousStep()">Voltar</button>
                    <button class="btn btn-moai-primary btn-lg" ng-click="finishOnboarding()">
                        <span ng-if="!isProcessing">Começar esse grande legado!</span>
                        <span ng-if="isProcessing">
                            <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                            Processando...
                        </span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para cropping de imagem -->
    <div class="modal" id="imageCropperModal" style="display: block; background: rgba(0,0,0,0.5); z-index: 1060;" ng-if="showImageCropper">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Recortar Imagem de Perfil</h5>
                    <button type="button" class="btn-close" ng-click="cancelImageUpload()"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center mb-3">
                        <p>Arraste e redimensione para ajustar sua foto de perfil</p>
                    </div>
                    <image-cropper
                        image-source="previewImageUrl"
                        on-crop-complete="uploadProfileImage(imageDataUrl)"
                        on-cancel="cancelImageUpload()">
                    </image-cropper>

                    <!-- Indicador de carregamento simples -->
                    <div class="text-center mt-3" ng-if="isProcessing">
                        <span class="spinner-border text-primary" role="status"></span>
                        <span class="ms-2">Processando imagem...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
